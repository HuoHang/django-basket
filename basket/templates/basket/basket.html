{% extends "basket/base.html" %}

{% block title %}Корзина{% endblock title %}
{% block content_title %}Корзина{% endblock content_title %}

{% block content %}
<script type="text/javascript">
<!--
$(document).ready(function() {
	$('#basket-refresh').click(function() {
		$(this).after('<input type="hidden" name="refresh" value="1" />');
	});
});
//-->
</script>
{% if formset.forms %}
    <form action="." method="post">
	    <table class="checkout">
	        <tr>
	            <th>&nbsp;</th>
	            <th>Наименование товара</th>
	            <th>Цена, руб.</th>
	            <th>Кол-во, шт.</th>
	            <th>Сумма, руб.</th>
	        </tr>
	        {% for form in formset.forms %}
			<tr>
	            <td>{{ form.keep }}{{ form.content_type }}{{ form.object_id }}{{ form.id }}</td>
	            <td><a target="_blank" href="{{ form.instance.content_object.get_absolute_url }}" title="Перейти на страницу товара">{{ form.instance.content_object }}</a></td>
				<td>{{ form.instance.get_price }}</td>
				<td>{{ form.quantity }}{{ form.quantity.errors }}</td>
				<td>{{ form.instance.get_sum }}</td>
			</tr>
	        {% endfor %}
	        <tr>
	            <th colspan="3">Итого</th>
	            <th>{{ order.goods }}</th>
	            <th>{{ order.summary }}</th>
	        </tr>
	    </table>
        <p>
		    {{ formset.management_form }}
		    {% csrf_token %}
            <input type="submit" value="Оформить заказ" />
            <input type="submit" id="basket-refresh" value="Пересчитать" />
        </p>
	</form>
{% else %}
	<p>Ваша корзина пуста</p>
{% endif %}

{# if you want, you can show order info form here #}

<form action="{% url order_confirm %}" method="POST">
    {{ order_form.as_p }}
    {% csrf_token %}
</form>

{% endblock content %}
